# ä»¿çœŸå·¥å…·ä½¿ç”¨æ€»ç»“

## âš¡ å¿«é€Ÿå¼€å§‹

```bash
cd /home/xuser/code_space/verilog/verilog/tb

# è¿è¡Œä»¿çœŸï¼ˆæ¨èï¼‰
./run_sim.sh
```

## ğŸ“Š ä»¿çœŸå·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | Icarus Verilog | Verilator |
|------|----------------|-----------|
| **çŠ¶æ€** | âœ… **æ¨èä½¿ç”¨** | âš ï¸ ä¸é€‚åˆå½“å‰ TB |
| **ä»¿çœŸç±»å‹** | äº‹ä»¶é©±åŠ¨ | å‘¨æœŸç²¾ç¡®ï¼ˆç»¼åˆï¼‰ |
| **å…¼å®¹æ€§** | å®Œæ•´æ”¯æŒ IEEE 1364 | æœ‰é™æ”¯æŒ |
| **`wait()` è¯­å¥** | âœ… æ”¯æŒ | âŒ ä¸æ”¯æŒ |
| **å¤æ‚æ—¶åº** | âœ… æ”¯æŒ | âŒ å—é™ |
| **å­¦ä¹ æ›²çº¿** | â­â­ ç®€å• | â­â­â­â­ å¤æ‚ |
| **é€‚ç”¨åœºæ™¯** | åŠŸèƒ½éªŒè¯ | è¯­æ³•/ç»¼åˆæ£€æŸ¥ |

## âœ… Icarus Verilogï¼ˆæ¨èï¼‰

### ä¸ºä»€ä¹ˆæ¨èï¼Ÿ

1. **å®Œæ•´æ”¯æŒ**ï¼šæ”¯æŒæ‰€æœ‰ testbench ç‰¹æ€§
2. **å¼€ç®±å³ç”¨**ï¼šæ— éœ€ä¿®æ”¹ä»£ç 
3. **æ˜“äºä½¿ç”¨**ï¼šç®€å•ç›´è§‚
4. **æ³¢å½¢å®Œæ•´**ï¼šVCD æ³¢å½¢åŒ…å«æ‰€æœ‰ä¿¡å·

### ä½¿ç”¨æ–¹æ³•

```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨æ™ºèƒ½è„šæœ¬ï¼ˆæœ€ç®€å•ï¼‰
cd tb
./run_sim.sh

# æ–¹æ³• 2ï¼šä½¿ç”¨ Makefile
cd tb
make                # ç¼–è¯‘å¹¶è¿è¡Œ
make waves          # æŸ¥çœ‹æ³¢å½¢
make clean          # æ¸…ç†

# æ–¹æ³• 3ï¼šæ‰‹åŠ¨å‘½ä»¤
cd tb
iverilog -o sim_build/sim.vvp \
    -g2005-sv \
    -I .. \
    -I ../verilog-ethernet/rtl \
    -I ../verilog-axi/rtl \
    eth_mac_rgmii_axi_tb.v \
    ../eth_mac_rgmii_axi.v \
    ...ï¼ˆå…¶ä»–æ–‡ä»¶ï¼‰

vvp sim_build/sim.vvp
```

### è¾“å‡ºç¤ºä¾‹

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Icarus Verilog ä»¿çœŸ                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[INFO] ç¼–è¯‘ Verilog æºæ–‡ä»¶...
[INFO] è¿è¡Œä»¿çœŸ...

========================================
ä»¥å¤ªç½‘ MAC RGMII AXI æµ‹è¯•å°
========================================
æµ‹è¯•æ—¶é—´: 2025-10-06 
ä»¿çœŸæ—¶é—´: 100 us
========================================

...ï¼ˆä»¿çœŸè¾“å‡ºï¼‰...

[å®Œæˆ] 0 ä¸ªé”™è¯¯
æ³¢å½¢æ–‡ä»¶: work/eth_mac_rgmii_axi_tb.vcd
```

## âš ï¸ Verilatorï¼ˆä¸æ¨èç”¨äºå½“å‰é¡¹ç›®ï¼‰

### ä¸ºä»€ä¹ˆä¸æ¨èï¼Ÿ

Verilator æ˜¯**ç»¼åˆå·¥å…·**è€Œéä¼ ç»Ÿä»¿çœŸå™¨ï¼Œå¯¹å½“å‰ testbench çš„é™åˆ¶ï¼š

```verilog
// âŒ ä¸æ”¯æŒï¼šwait() è¯­å¥
wait(s_axil_awready && s_axil_wready);

// âŒ ä¸æ”¯æŒï¼štask ä¸­çš„å¤šä¸ªäº‹ä»¶æ§åˆ¶
task axil_write;
    @(posedge logic_clk);    // âŒ
    ...
    @(posedge logic_clk);    // âŒ ç¬¬äºŒä¸ªå°±ä¸è¡Œ
endtask

// âŒ ä¸æ”¯æŒï¼šforever ä¸­çš„å»¶è¿Ÿï¼ˆæ—  --timingï¼‰
forever #(CLK_PERIOD/2) clk = ~clk;
```

### ä½•æ—¶ä½¿ç”¨ Verilatorï¼Ÿ

Verilator æ›´é€‚åˆï¼š

```bash
# è¯­æ³•æ£€æŸ¥
verilator --lint-only ../eth_mac_rgmii_axi.v \
    -I../verilog-ethernet/rtl \
    -I../verilog-axi/rtl

# ç»¼åˆå‰æ£€æŸ¥
verilator --top-module eth_mac_rgmii_axi \
    --lint-only \
    ï¼ˆæ–‡ä»¶åˆ—è¡¨ï¼‰
```

**ä¸é€‚åˆ**ï¼šåŠŸèƒ½ä»¿çœŸï¼ˆé™¤éé‡å†™ä¸º C++ testbenchï¼‰

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

å¯¹äºæ‚¨çš„è®¾è®¡è§„æ¨¡ï¼ˆ~5K è¡Œ RTLï¼‰ï¼š

| å·¥å…· | ç¼–è¯‘æ—¶é—´ | è¿è¡Œæ—¶é—´ | æ€»æ—¶é—´ | é€‚ç”¨æ€§ |
|------|----------|----------|---------|--------|
| **Icarus** | 5ç§’ | 10ç§’ | 15ç§’ | âœ… å®Œç¾ |
| **Verilator** | 20ç§’ | 2ç§’ | 22ç§’ | âŒ éœ€è¦é‡å†™ |

**ç»“è®º**ï¼šå¯¹äºä¸­ç­‰è§„æ¨¡è®¾è®¡ï¼ŒIcarus Verilog æ›´å¿«æ›´æ–¹ä¾¿ï¼

## ğŸ”§ å¸¸è§é—®é¢˜

### Q: æ³¢å½¢æ–‡ä»¶åœ¨å“ªé‡Œï¼Ÿ

**A**: `tb/work/eth_mac_rgmii_axi_tb.vcd`

```bash
cd tb
gtkwave work/eth_mac_rgmii_axi_tb.vcd work/eth_mac_rgmii_axi_tb.gtkw
```

### Q: å¦‚ä½•ä¿®æ”¹ä»¿çœŸæ—¶é—´ï¼Ÿ

**A**: ç¼–è¾‘ `tb/eth_mac_rgmii_axi_tb.v`ï¼š

```verilog
initial begin
    // ... 
    #100000000;  // ä¿®æ”¹è¿™ä¸ªæ•°å­—ï¼ˆå•ä½ï¼šæ—¶é—´åˆ»åº¦ï¼‰
    $finish;
end
```

### Q: ä»¿çœŸå¤ªæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**: 

1. **å‡å°‘ä»¿çœŸæ—¶é—´**ï¼ˆä¸Šé¢çš„æ–¹æ³•ï¼‰
2. **ç¦ç”¨æ³¢å½¢è®°å½•**ï¼ˆåˆ é™¤ `$dumpfile` ç›¸å…³ä»£ç ï¼‰
3. **å‡å°è¿½è¸ªæ·±åº¦**
4. **ä»…åœ¨å…³é”®æ—¶åˆ»è®°å½•æ³¢å½¢**

### Q: æˆ‘å¿…é¡»ä½¿ç”¨ Verilator æ€ä¹ˆåŠï¼Ÿ

**A**: éœ€è¦**å®Œå…¨é‡å†™ testbench**ï¼š

1. åˆ›å»ºçº¯ C++ testbench
2. ç§»é™¤æ‰€æœ‰ `wait()` è¯­å¥
3. é‡å†™æ‰€æœ‰ tasks ä¸º C++ å‡½æ•°
4. æ‰‹åŠ¨ç®¡ç†æ—¶åº

**ä»£ä»·å¾ˆå¤§ï¼Œä¸å»ºè®®ï¼**

## ğŸ¯ æ¨èå·¥ä½œæµç¨‹

### æ—¥å¸¸å¼€å‘

```bash
# 1. ä¿®æ”¹ RTL ä»£ç 
vim ../eth_mac_rgmii_axi.v

# 2. è¿è¡Œä»¿çœŸ
cd tb
./run_sim.sh

# 3. æŸ¥çœ‹æ³¢å½¢ï¼ˆå¦‚æœæœ‰é”™è¯¯ï¼‰
make waves

# 4. è¿­ä»£ä¿®æ”¹
```

### å®Œæ•´éªŒè¯

```bash
# Step 1: åŠŸèƒ½ä»¿çœŸï¼ˆIcarusï¼‰
cd tb
make clean
make
make waves

# Step 2: è¯­æ³•æ£€æŸ¥ï¼ˆVerilatorï¼Œå¯é€‰ï¼‰
verilator --lint-only \
    --top-module eth_mac_rgmii_axi \
    ../eth_mac_rgmii_axi.v \
    -I../verilog-ethernet/rtl \
    -I../verilog-axi/rtl

# Step 3: FPGA ç»¼åˆ
# ä½¿ç”¨ Vivado/Quartus
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **ä¸»æµ‹è¯•æ–‡æ¡£**: `TESTING_GUIDE.md`
- **Verilator è¯¦ç»†è¯´æ˜**: `VERILATOR_NOTE.md`
- **å¿«é€Ÿå‚è€ƒ**: `TESTING_SUMMARY.txt`
- **æµ‹è¯•ç›®å½• README**: `tb/README_TEST.md`

## âœ… æ€»ç»“

| éœ€æ±‚ | å·¥å…·é€‰æ‹© |
|------|----------|
| åŠŸèƒ½ä»¿çœŸ | âœ… **Icarus Verilog** |
| æ³¢å½¢åˆ†æ | âœ… **Icarus + GTKWave** |
| è¯­æ³•æ£€æŸ¥ | âœ… **Verilator --lint-only** |
| ç»¼åˆæ£€æŸ¥ | âœ… **Verilator --lint-only** |
| FPGA å®ç° | âœ… **Vivado/Quartus** |

---

## ğŸš€ ç«‹å³å¼€å§‹

```bash
cd /home/xuser/code_space/verilog/verilog/tb
./run_sim.sh
```

**å°±è¿™ä¹ˆç®€å•ï¼** ğŸ‰


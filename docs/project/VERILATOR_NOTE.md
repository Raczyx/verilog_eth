# Verilator ä»¿çœŸè¯´æ˜

## âš ï¸ é‡è¦æç¤º

ç»è¿‡æµ‹è¯•ï¼Œ**å½“å‰çš„ testbench ä¸é€‚åˆç”¨ Verilator è¿›è¡Œä»¿çœŸ**ã€‚

## ğŸ” åŸå› 

Verilator æ˜¯ä¸€ä¸ª**ç»¼åˆå·¥å…·**è€Œä¸æ˜¯ä¼ ç»Ÿçš„äº‹ä»¶é©±åŠ¨ä»¿çœŸå™¨ï¼Œå®ƒå¯¹ä»¥ä¸‹ Verilog æ„é€ æ”¯æŒæœ‰é™ï¼š

1. **`wait()` è¯­å¥**ï¼šå®Œå…¨ä¸æ”¯æŒ
2. **å¤šä¸ª `@(posedge)` åœ¨åŒä¸€ä¸ª task ä¸­**ï¼šéœ€è¦ `--timing` æ”¯æŒ
3. **å¤æ‚çš„æ—¶åºæ§åˆ¶**ï¼šä¸é€‚åˆä¼ ç»Ÿçš„ testbench é£æ ¼

### å½“å‰ testbench ä½¿ç”¨çš„ä¸å…¼å®¹ç‰¹æ€§

```verilog
// âŒ Verilator ä¸æ”¯æŒ
task axil_write;
    @(posedge logic_clk);         // task ä¸­çš„äº‹ä»¶æ§åˆ¶
    wait(s_axil_awready);         // wait è¯­å¥
    @(posedge logic_clk);         // å¤šä¸ªäº‹ä»¶æ§åˆ¶
endtask

// âŒ Verilator ä¸æ”¯æŒ  
forever #(CLK_PERIOD_GTX/2) gtx_clk = ~gtx_clk;  // å»¶è¿Ÿéœ€è¦ --timing
```

## âœ… æ¨èè§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ 1ï¼šä½¿ç”¨ Icarus Verilogï¼ˆæ¨èï¼‰

**Icarus Verilog å®Œç¾æ”¯æŒæ‚¨çš„ testbenchï¼**

```bash
# å¿«é€Ÿè¿è¡Œ
cd tb
./run_sim.sh

# æˆ–ä½¿ç”¨ Makefile
make SIM=iverilog

# æŸ¥çœ‹æ³¢å½¢
make waves
```

**ä¼˜ç‚¹**ï¼š
- âœ… å®Œæ•´æ”¯æŒæ‰€æœ‰ Verilog ç‰¹æ€§
- âœ… æ”¯æŒ `wait()` å’Œå¤æ‚æ—¶åº
- âœ… testbench æ— éœ€ä¿®æ”¹
- âœ… çœŸæ­£çš„äº‹ä»¶é©±åŠ¨ä»¿çœŸ
- âœ… æ³¢å½¢æ–‡ä»¶å®Œæ•´

### æ–¹æ¡ˆ 2ï¼šVerilator ç”¨äºç»¼åˆæ£€æŸ¥

Verilator æ›´é€‚åˆç”¨äºï¼š
- **è¯­æ³•æ£€æŸ¥**
- **ç»¼åˆæ£€æŸ¥**
- **å¿«é€Ÿç¼–è¯‘éªŒè¯**

è€Œä¸æ˜¯åŠŸèƒ½ä»¿çœŸã€‚

## ğŸ“Š å·¥å…·å¯¹æ¯”

| ç‰¹æ€§ | Icarus Verilog | Verilator |
|------|----------------|-----------|
| **ä»¿çœŸç±»å‹** | äº‹ä»¶é©±åŠ¨ | å‘¨æœŸç²¾ç¡® |
| **`wait()` æ”¯æŒ** | âœ… å®Œæ•´ | âŒ ä¸æ”¯æŒ |
| **å¤æ‚æ—¶åº** | âœ… å®Œæ•´ | âš ï¸ å—é™ |
| **ä»¿çœŸé€Ÿåº¦** | ä¸­ç­‰ | æå¿« |
| **é€‚ç”¨åœºæ™¯** | åŠŸèƒ½éªŒè¯ | ç»¼åˆæ£€æŸ¥ |
| **å­¦ä¹ æ›²çº¿** | ç®€å• | éœ€è¦ C++ |

## ğŸš€ å®é™…ä½¿ç”¨å»ºè®®

### æ—¥å¸¸å¼€å‘æµç¨‹

```bash
# 1. åŠŸèƒ½ä»¿çœŸï¼ˆä½¿ç”¨ Icarusï¼‰
cd tb
./run_sim.sh

# 2. æŸ¥çœ‹æ³¢å½¢
make waves

# 3. å¦‚éœ€å¿«é€Ÿè¯­æ³•æ£€æŸ¥ï¼ˆå¯é€‰ï¼Œä½¿ç”¨ Verilatorï¼‰
verilator --lint-only ../eth_mac_rgmii_axi.v \
    -I../verilog-ethernet/rtl \
    -I../verilog-axi/rtl
```

### å®Œæ•´éªŒè¯æµç¨‹

```bash
# Step 1: ä½¿ç”¨ Icarus è¿›è¡ŒåŠŸèƒ½éªŒè¯
cd /home/xuser/code_space/verilog/verilog/tb
make clean
make SIM=iverilog
make waves

# Step 2: ä½¿ç”¨ Verilator è¿›è¡Œç»¼åˆæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
verilator --lint-only \
    --top-module eth_mac_rgmii_axi \
    ../eth_mac_rgmii_axi.v \
    ../eth_frame_filter.v \
    ../eth_mac_axil_regs.v \
    -I../verilog-ethernet/rtl \
    -I../verilog-axi/rtl

# Step 3: FPGA ç»¼åˆï¼ˆVivado/Quartusï¼‰
# ... è¿›å…¥æ‚¨çš„FPGAå·¥å…·æµç¨‹
```

## ğŸ“ ä¸ºä»€ä¹ˆä¼šè¿™æ ·ï¼Ÿ

### Verilator çš„è®¾è®¡ç›®æ ‡

Verilator å°† Verilog **ç¼–è¯‘æˆ C++**ï¼Œç„¶åç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼š

```
Verilog â†’ C++ â†’ å¯æ‰§è¡Œæ–‡ä»¶
```

è¿™ä½¿å¾—å®ƒï¼š
- âœ… ä»¿çœŸé€Ÿåº¦æå¿«ï¼ˆ10-100å€ï¼‰
- âœ… å¯ä»¥ä½¿ç”¨ C++ è°ƒè¯•å·¥å…·
- âŒ ä½†å¤±å»äº†äº‹ä»¶é©±åŠ¨çš„çµæ´»æ€§

### Icarus Verilog çš„è®¾è®¡ç›®æ ‡

Icarus Verilog æ˜¯**è§£é‡Šæ‰§è¡Œ**çš„äº‹ä»¶é©±åŠ¨ä»¿çœŸå™¨ï¼š

```
Verilog â†’ ä¸­é—´è¡¨ç¤º â†’ äº‹ä»¶é˜Ÿåˆ— â†’ ä»¿çœŸ
```

è¿™ä½¿å¾—å®ƒï¼š
- âœ… å®Œæ•´æ”¯æŒ IEEE 1364-2005
- âœ… æ”¯æŒæ‰€æœ‰ testbench ç‰¹æ€§
- âœ… çœŸæ­£çš„æ—¶åºä»¿çœŸ
- âš ï¸ é€Ÿåº¦è¾ƒæ…¢ï¼ˆä½†å¯¹ä¸­å°å‹è®¾è®¡è¶³å¤Ÿï¼‰

## ğŸ“‹ æ€»ç»“

**å¯¹äºæ‚¨çš„é¡¹ç›®ï¼š**

| ç”¨é€” | å·¥å…·é€‰æ‹© |
|------|----------|
| **åŠŸèƒ½ä»¿çœŸå’ŒéªŒè¯** | âœ… **Icarus Verilog** |
| **æ³¢å½¢åˆ†æ** | âœ… Icarus + GTKWave |
| **è¯­æ³•æ£€æŸ¥** | âœ… Verilator --lint-only |
| **FPGA ç»¼åˆ** | âœ… Vivado/Quartus |
| **å¿«é€Ÿç¼–è¯‘éªŒè¯** | âœ… Verilatorï¼ˆéœ€è¦ç®€åŒ– TBï¼‰ |

## ğŸ”§ å¦‚æœåšæŒä½¿ç”¨ Verilator

å¦‚æœæ‚¨ç¡®å®æƒ³ä½¿ç”¨ Verilator è¿›è¡Œä»¿çœŸï¼Œéœ€è¦ï¼š

1. **å®Œå…¨é‡å†™ testbench ä¸º C++** é£æ ¼
2. **ç§»é™¤æ‰€æœ‰ `wait()` è¯­å¥**
3. **æ¯ä¸ª task åªèƒ½æœ‰ä¸€ä¸ªé¡¶å±‚ `@(posedge)`**
4. **ä½¿ç”¨ C++ æ¨¡å‹æ›¿ä»£ Verilog tasks**

è¿™éœ€è¦**å¤§é‡å·¥ä½œ**ä¸”**æ”¶ç›Šæœ‰é™**ï¼Œå› ä¸ºï¼š
- Icarus Verilog å·²ç»å·¥ä½œå¾—å¾ˆå¥½
- å¯¹äºè¿™ä¸ªè§„æ¨¡çš„è®¾è®¡ï¼Œé€Ÿåº¦å·®å¼‚ä¸å¤§
- Verilator æ›´é€‚åˆæ›´å¤§è§„æ¨¡çš„è®¾è®¡

## âœ… æœ€ç»ˆå»ºè®®

**ä½¿ç”¨ Icarus Verilogï¼** å®ƒå®Œç¾æ”¯æŒæ‚¨çš„è®¾è®¡ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹ã€‚

```bash
cd /home/xuser/code_space/verilog/verilog/tb
./run_sim.sh
```

è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘åœ¨æœ€åˆåˆ›å»ºæµ‹è¯•ç¯å¢ƒæ—¶é€‰æ‹©äº† Icarus Verilog ä½œä¸ºä¸»è¦ä»¿çœŸå™¨ã€‚

---

**æ³¨æ„**ï¼šVerilator ç›¸å…³æ–‡ä»¶ä¿ç•™åœ¨é¡¹ç›®ä¸­ï¼Œä¾›æœ‰éœ€è¦æ—¶ä½¿ç”¨ï¼Œä½†**ä¸æ¨èç”¨äºå½“å‰ testbench çš„åŠŸèƒ½ä»¿çœŸ**ã€‚


# 以太网 MAC RGMII AXI - 架构设计图

## 1. 整体系统架构

```
╔══════════════════════════════════════════════════════════════════════════════╗
║                    以太网 MAC RGMII AXI IP 核心                               ║
║                          eth_mac_rgmii_axi                                    ║
╚══════════════════════════════════════════════════════════════════════════════╝

外部接口:
┌─────────────┐     ┌──────────────┐     ┌──────────────┐
│  RGMII PHY  │────▶│   本IP核心    │────▶│  AXI总线系统  │
│  (物理层)   │◀────│              │◀────│  (内存/CPU)   │
└─────────────┘     └──────────────┘     └──────────────┘
                           │
                           │ AXI-Lite
                           ▼
                    ┌──────────────┐
                    │  控制寄存器   │
                    │   (配置)     │
                    └──────────────┘


═══════════════════════════════════════════════════════════════════════════════
                            内部模块架构
═══════════════════════════════════════════════════════════════════════════════

接收路径 (RX):
┏━━━━━━━━━━┓     ┏━━━━━━━━━━━┓     ┏━━━━━━━━━━━┓     ┏━━━━━━━━━━━┓
┃  RGMII   ┃     ┃    MAC    ┃     ┃   Frame   ┃     ┃ Ethernet  ┃
┃   PHY    ┃────▶┃  1G FIFO  ┃────▶┃  Filter   ┃────▶┃  RX Parse ┃
┃ (外部)   ┃     ┃           ┃     ┃           ┃     ┃           ┃
┗━━━━━━━━━━┛     ┗━━━━━━━━━━━┛     ┗━━━━━━━━━━━┛     ┗━━━━━━━━━━━┛
                       │                  │                   │
                       │                  │                   ▼
                       │                  │            ┏━━━━━━━━━━━┓
                       │                  │            ┃    IP/    ┃
                       │                  │            ┃    ARP    ┃
                       │                  │            ┃  Complete ┃
                       │                  │            ┗━━━━━━━━━━━┛
                       │                  │                   │
                       │                  ▼                   │
                       │           ┌────────────┐            │
                       │           │ DMA Write  │◀───────────┘
                       │           │  (RX DMA)  │
                       │           └────────────┘
                       │                  │
                       │                  ▼
                       │           ┏━━━━━━━━━━━┓
                       └──────────▶┃    AXI    ┃
                                   ┃   Memory  ┃
                                   ┃           ┃
                                   ┗━━━━━━━━━━━┛

发送路径 (TX):
┏━━━━━━━━━━┓     ┏━━━━━━━━━━━┓     ┏━━━━━━━━━━━┓     ┏━━━━━━━━━━━┓
┃  RGMII   ┃     ┃    MAC    ┃     ┃ Ethernet  ┃     ┃    IP/    ┃
┃   PHY    ┃◀────┃  1G FIFO  ┃◀────┃  TX Build ┃◀────┃    ARP    ┃
┃ (外部)   ┃     ┃           ┃     ┃           ┃     ┃  Complete ┃
┗━━━━━━━━━━┛     ┗━━━━━━━━━━━┛     ┗━━━━━━━━━━━┛     ┗━━━━━━━━━━━┛
                       ▲                                      ▲
                       │                                      │
                       │                               ┌────────────┐
                       │                               │  DMA Read  │
                       │                               │  (TX DMA)  │
                       │                               └────────────┘
                       │                                      ▲
                       │                                      │
                       │                               ┏━━━━━━━━━━━┓
                       └───────────────────────────────┃    AXI    ┃
                                                       ┃   Memory  ┃
                                                       ┃           ┃
                                                       ┗━━━━━━━━━━━┛

控制路径:
                        ┏━━━━━━━━━━━━━━━━━━━━━━━┓
                        ┃    AXI-Lite Slave     ┃
                        ┃   Control Registers   ┃
                        ┃  (eth_mac_axil_regs)  ┃
                        ┗━━━━━━━━━━━━━━━━━━━━━━━┛
                          │    │    │    │    │
              ┌───────────┼────┼────┼────┼────┼───────────┐
              │           │    │    │    │    │           │
              ▼           ▼    ▼    ▼    ▼    ▼           ▼
           [MAC配置] [IP配置] [过滤器] [DMA] [中断] [描述符管理]
```

## 2. 详细模块结构

```
┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
┃                          eth_mac_rgmii_axi (顶层)                        ┃
┃                                                                           ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 1. RGMII MAC (eth_mac_1g_rgmii_fifo)                            │   ┃
┃  │    - 1Gbps 以太网MAC控制器                                       │   ┃
┃  │    - TX/RX FIFO缓冲                                              │   ┃
┃  │    - RGMII物理接口                                               │   ┃
┃  │    - 帧填充和CRC                                                 │   ┃
┃  │    端口: 8-bit AXI-Stream ↔ RGMII                               │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┃                                  ↕                                       ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 2. 帧过滤器 (eth_frame_filter)                                   │   ┃
┃  │    - MAC地址过滤 (单播/广播/组播)                                │   ┃
┃  │    - 混杂模式支持                                                │   ┃
┃  │    - 可配置过滤规则                                              │   ┃
┃  │    端口: 8-bit AXI-Stream ↔ 8-bit AXI-Stream                    │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┃                                  ↕                                       ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 3. 以太网帧解析/构建 (eth_axis_rx / eth_axis_tx)                │   ┃
┃  │    - RX: 解析以太网头部 (目的MAC, 源MAC, EtherType)              │   ┃
┃  │    - TX: 构建以太网帧                                            │   ┃
┃  │    端口: 8-bit AXI-Stream ↔ 以太网帧结构                        │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┃                                  ↕                                       ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 4. IP/ARP协议栈 (ip_complete)                                    │   ┃
┃  │    - ARP请求/应答处理                                            │   ┃
┃  │    - ARP缓存管理                                                 │   ┃
┃  │    - IP包解析和构建                                              │   ┃
┃  │    - MAC地址解析                                                 │   ┃
┃  │    端口: 以太网帧 ↔ IP包                                         │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┃                                  ↕                                       ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 5. DMA引擎 (axi_dma)                                             │   ┃
┃  │    - RX DMA: 接收数据写入内存                                    │   ┃
┃  │    - TX DMA: 从内存读取数据发送                                  │   ┃
┃  │    - 描述符管理                                                  │   ┃
┃  │    - Scatter-Gather支持                                          │   ┃
┃  │    端口: 64-bit AXI-Stream ↔ AXI Master                         │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┃                                  ↕                                       ┃
┃  ┌─────────────────────────────────────────────────────────────────┐   ┃
┃  │ 6. 控制寄存器 (eth_mac_axil_regs)                                │   ┃
┃  │    - 26个32位寄存器                                              │   ┃
┃  │    - MAC/IP配置                                                  │   ┃
┃  │    - DMA描述符管理                                               │   ┃
┃  │    - 中断控制                                                    │   ┃
┃  │    端口: AXI-Lite Slave                                          │   ┃
┃  └─────────────────────────────────────────────────────────────────┘   ┃
┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
```

## 3. 数据流详细图

### 3.1 接收数据流 (RX Path)

```
外部设备                                                         系统内存
   │                                                                 ▲
   │ 以太网帧                                                        │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤1: RGMII物理接口                                            │ │
│ ┌──────────────┐                                               │ │
│ │ RGMII RX CLK │  4-bit DDR 数据                               │ │
│ │ RGMII RXD[3:0]│ ──▶ 8-bit SDR 数据                          │ │
│ │ RGMII RX CTL │                                               │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit AXI-Stream                                               │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤2: MAC接收处理                                              │ │
│ ┌──────────────┐                                               │ │
│ │  - 前导码检测 │                                               │ │
│ │  - 帧定界    │                                               │ │
│ │  - FCS校验   │                                               │ │
│ │  - RX FIFO   │  深度: 4096字节                               │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit AXI-Stream (logic_clk域)                                │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤3: 帧过滤                                                   │ │
│ ┌──────────────┐                                               │ │
│ │  提取目的MAC  │ ──▶ 与local_mac比较                          │ │
│ │              │ ──▶ 检查广播 (FF:FF:FF:FF:FF:FF)             │ │
│ │              │ ──▶ 检查组播 (bit0 = 1)                      │ │
│ │  过滤决策    │ ──▶ 混杂模式: 接受所有                       │ │
│ └──────────────┘                                               │ │
│ 如果通过 ──▶                                                    │ │
│ 如果拒绝 ──▶ 丢弃帧                                             │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit AXI-Stream (已过滤)                                      │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤4: 以太网帧解析                                             │ │
│ ┌──────────────────────────────────────┐                       │ │
│ │  以太网帧格式:                        │                       │ │
│ │  ┌──────┬──────┬────────┬────────┐  │                       │ │
│ │  │Dest  │Source│EtherTyp│Payload │  │                       │ │
│ │  │MAC(6)│MAC(6)│  (2)   │ (可变) │  │                       │ │
│ │  └──────┴──────┴────────┴────────┘  │                       │ │
│ │         ▼        ▼         ▼         │                       │ │
│ │     解析为结构化字段                  │                       │ │
│ └──────────────────────────────────────┘                       │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ EtherType = 0x0806?                                            │
   ├──Yes─▶ ARP 包                                                 │
   │        │                                                        │
   │        ▼                                                        │
   │  ┌─────────────────────────────┐                              │
   │  │ 步骤5a: ARP处理              │                              │
   │  │  - 解析ARP请求/应答          │                              │
   │  │  - 更新ARP缓存               │                              │
   │  │  - 生成ARP应答 (如果是请求)  │                              │
   │  └─────────────────────────────┘                              │
   │                                                                 │
   ├──No──▶ EtherType = 0x0800?                                    │
   │        │                                                        │
   │        └──Yes─▶ IP 包                                          │
   │                 │                                               │
   │                 ▼                                               │
   │  ┌─────────────────────────────┐                              │
   │  │ 步骤5b: IP包处理             │                              │
   │  │  - 解析IP头部                │                              │
   │  │  - 校验头部校验和            │                              │
   │  │  - 提取源/目的IP             │                              │
   │  └─────────────────────────────┘                              │
   │                 │                                               │
   │                 │ IP Payload                                    │
   │                 ▼                                               │
   │  ┌─────────────────────────────┐                              │
   │  │ 步骤6: DMA写入               │                              │
   │  │  - 位宽转换 8-bit → 64-bit  │                              │
   │  │  - 读取RX描述符              │                              │
   │  │  - AXI写突发传输             │                              │
   │  │  - 更新描述符状态            │                              │
   │  └─────────────────────────────┘                              │
   │                 │                                               │
   │                 │ AXI Master 写通道                            │
   │                 ▼                                               │
   └─────────────────────────────────────────────────────────────▶ 内存
                                                                    ▲
                                                                    │
                                                                完成中断
```

### 3.2 发送数据流 (TX Path)

```
系统内存                                                         外部设备
   │                                                                 ▲
   │ CPU准备数据                                                     │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤1: 配置TX描述符                                             │ │
│ ┌──────────────────────────────────────┐                       │ │
│ │ CPU写入寄存器:                        │                       │ │
│ │  - dma_tx_desc_addr = 数据地址       │                       │ │
│ │  - dma_tx_desc_len  = 数据长度       │                       │ │
│ │  - dma_tx_desc_tag  = 标识符         │                       │ │
│ │  - dma_tx_desc_valid = 1 (启动)     │                       │ │
│ └──────────────────────────────────────┘                       │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 描述符就绪                                                      │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤2: DMA读取                                                  │ │
│ ┌──────────────┐                                               │ │
│ │  AXI读突发   │  从内存读取以太网帧数据                       │ │
│ │  地址: desc  │                                               │ │
│ │  长度: desc  │  64-bit → 8-bit 转换                         │ │
│ │              │  生成AXI-Stream                               │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 64-bit AXI-Stream                                              │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤3: 位宽转换                                                 │ │
│ ┌──────────────┐                                               │ │
│ │ 64-bit       │ ──▶ 8-bit                                     │ │
│ │ tdata[63:0]  │     tdata[7:0]                                │ │
│ │ tkeep[7:0]   │     逐字节输出                                │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit AXI-Stream (IP payload)                                 │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤4: IP/ARP处理                                               │ │
│ ┌──────────────────────────────────────┐                       │ │
│ │  如果需要发送IP包:                    │                       │ │
│ │   - 查找目标IP对应的MAC地址           │                       │ │
│ │   - 查ARP缓存                         │                       │ │
│ │   - 如果未找到,发送ARP请求            │                       │ │
│ │   - 等待ARP应答                       │                       │ │
│ │   - 添加IP头部                        │                       │ │
│ │   - 计算IP校验和                      │                       │ │
│ └──────────────────────────────────────┘                       │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 以太网帧结构 (Header fields)                                   │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤5: 以太网帧构建                                             │ │
│ ┌──────────────────────────────────────┐                       │ │
│ │  构建以太网帧:                        │                       │ │
│ │  ┌──────┬──────┬────────┬────────┐  │                       │ │
│ │  │Dest  │Source│EtherTyp│Payload │  │                       │ │
│ │  │MAC   │MAC   │        │        │  │                       │ │
│ │  │(查表)│(配置)│ (0x0800)│(IP包) │  │                       │ │
│ │  └──────┴──────┴────────┴────────┘  │                       │ │
│ └──────────────────────────────────────┘                       │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit AXI-Stream (完整以太网帧)                                │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤6: MAC发送处理                                              │ │
│ ┌──────────────┐                                               │ │
│ │  TX FIFO     │  缓冲完整帧                                   │ │
│ │  帧填充      │  如果<64字节,填充到64                         │ │
│ │  添加前导码   │  7字节前导码 + 1字节SFD                       │ │
│ │  计算FCS     │  CRC-32校验                                   │ │
│ │  添加FCS     │  4字节FCS追加到帧尾                           │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ 8-bit SDR 数据 (gtx_clk域)                                     │
   ▼                                                                 │
┌────────────────────────────────────────────────────────────────┐ │
│ 步骤7: RGMII物理接口                                            │ │
│ ┌──────────────┐                                               │ │
│ │ 8-bit SDR    │ ──▶ 4-bit DDR                                │ │
│ │ RGMII TX CLK │  125MHz时钟                                   │ │
│ │ RGMII TXD[3:0]│ 上升沿/下降沿各传输4位                       │ │
│ │ RGMII TX CTL │  控制信号(使能+错误)                          │ │
│ └──────────────┘                                               │ │
└────────────────────────────────────────────────────────────────┘ │
   │                                                                 │
   │ RGMII信号                                                       │
   └────────────────────────────────────────────────────────────▶ PHY
                                                                    ▲
                                                                    │
                                                                发送完成
```

## 4. 控制平面

```
┌──────────────────────────────────────────────────────────────────┐
│                      控制寄存器映射                                │
│                   (AXI-Lite 地址空间)                             │
└──────────────────────────────────────────────────────────────────┘

CPU/软件
   │
   │ AXI-Lite 总线
   ▼
┌─────────────────────────────────────────────────────────────────┐
│ 寄存器地址映射:                                                  │
│                                                                  │
│ 0x0000: 控制寄存器                                               │
│         [0]: cfg_tx_enable   - TX使能                           │
│         [1]: cfg_rx_enable   - RX使能                           │
│         [2]: dma_tx_enable   - TX DMA使能                       │
│         [3]: dma_rx_enable   - RX DMA使能                       │
│                                                                  │
│ 0x0004: 状态寄存器 (只读)                                        │
│         [1:0]: mac_speed     - 链路速度                         │
│         [2]: tx_error        - 发送错误                          │
│         [3]: rx_error        - 接收错误                          │
│                                                                  │
│ 0x0008-0x000C: 本地MAC地址                                       │
│         48位MAC地址                                              │
│                                                                  │
│ 0x0010: 本地IP地址                                               │
│         32位IPv4地址                                             │
│                                                                  │
│ 0x0014: 网关IP地址                                               │
│ 0x0018: 子网掩码                                                 │
│                                                                  │
│ 0x001C: 过滤器配置                                               │
│         [0]: filter_enable      - 过滤器使能                    │
│         [1]: promiscuous_mode   - 混杂模式                      │
│         [2]: broadcast_enable   - 广播使能                      │
│         [3]: multicast_enable   - 组播使能                      │
│                                                                  │
│ 0x0020: 中断使能                                                 │
│         [0]: irq_rx_done_en     - RX完成中断                    │
│         [1]: irq_tx_done_en     - TX完成中断                    │
│         [2]: irq_rx_error_en    - RX错误中断                    │
│         [3]: irq_tx_error_en    - TX错误中断                    │
│                                                                  │
│ 0x0024: 中断状态 (W1C)                                           │
│         [0]: irq_rx_done        - RX完成                        │
│         [1]: irq_tx_done        - TX完成                        │
│         [2]: irq_rx_error       - RX错误                        │
│         [3]: irq_tx_error       - TX错误                        │
│                                                                  │
│ 0x0028: IFG配置                                                  │
│         帧间隙周期数                                             │
│                                                                  │
│ 0x0030: RX DMA 描述符地址                                        │
│ 0x0034: RX DMA 描述符长度                                        │
│ 0x0038: RX DMA 描述符Tag                                         │
│ 0x003C: RX DMA 描述符控制                                        │
│         [0]: valid - 写1启动                                     │
│                                                                  │
│ 0x0040: TX DMA 描述符地址                                        │
│ 0x0044: TX DMA 描述符长度                                        │
│ 0x0048: TX DMA 描述符Tag                                         │
│ 0x004C: TX DMA 描述符控制                                        │
│         [0]: valid - 写1启动                                     │
└─────────────────────────────────────────────────────────────────┘
       │                │                 │
       ▼                ▼                 ▼
   [配置输出]      [状态输入]        [DMA接口]
       │                │                 │
       └────────────────┴─────────────────┘
                        │
                        ▼
              ┌──────────────────┐
              │ 各功能模块        │
              │ - MAC            │
              │ - Filter         │
              │ - IP/ARP         │
              │ - DMA            │
              └──────────────────┘
```

## 5. 时钟域

```
┌──────────────────────────────────────────────────────────────────┐
│                         时钟域架构                                │
└──────────────────────────────────────────────────────────────────┘

时钟域1: gtx_clk (125MHz)
├─ RGMII TX 物理接口
├─ RGMII RX 物理接口 (异步)
└─ MAC TX/RX 逻辑

时钟域2: gtx_clk90 (125MHz, 90度相移)
└─ RGMII TX DDR输出 (可选)

时钟域3: logic_clk (可变, 通常50-125MHz)
├─ MAC FIFO输出
├─ Frame Filter
├─ Ethernet RX/TX
├─ IP/ARP Complete
├─ DMA Engine
├─ AXI Master接口
└─ AXI-Lite Slave接口

跨时钟域同步:
┌───────────────┐
│ gtx_clk       │──▶ 异步FIFO ──▶ logic_clk
│ (MAC核心)     │                 (系统总线)
└───────────────┘

位置:
- MAC RX: gtx_clk → logic_clk (axis_async_fifo)
- MAC TX: logic_clk → gtx_clk (axis_async_fifo)
```

## 6. 中断系统

```
┌──────────────────────────────────────────────────────────────────┐
│                         中断处理流程                              │
└──────────────────────────────────────────────────────────────────┘

事件源                    中断生成                    中断输出
──────                   ──────────                  ────────

DMA RX完成
└─▶ dma_rx_desc_status_valid ──▶ irq_rx_done ──┐
                                               │
DMA TX完成                                     │
└─▶ dma_tx_desc_status_valid ──▶ irq_tx_done ─┤
                                               │
MAC RX错误                                     ├─▶ [中断使能]
└─▶ mac_rx_error_bad_fcs    ──▶ irq_rx_error ─┤        AND
                                               │         │
MAC TX错误                                     │         ▼
└─▶ mac_tx_error_underflow  ──▶ irq_tx_error ─┘       IRQ输出
                                                         │
                                                         ▼
                                                    中断控制器
                                                         │
                                                         ▼
                                                       CPU

中断处理步骤:
1. 硬件事件发生 → 置位中断状态寄存器
2. 如果中断使能 → 拉高IRQ引脚
3. CPU响应中断 → 读取中断状态寄存器
4. CPU处理中断 → 写1清除中断状态
5. IRQ引脚恢复低电平
```

## 7. ARP协议处理流程

```
┌──────────────────────────────────────────────────────────────────┐
│                      ARP处理流程图                                │
└──────────────────────────────────────────────────────────────────┘

接收ARP请求:
───────────
以太网帧 (EtherType=0x0806)
   │
   ▼
┌─────────────────────┐
│ 解析ARP包            │
│ - 操作: Request(1)  │
│ - 目标IP            │
│ - 发送者MAC/IP      │
└─────────────────────┘
   │
   ▼
目标IP == local_ip?
   │
   ├─Yes─▶ ┌─────────────────────┐
   │       │ 生成ARP应答          │
   │       │ - 操作: Reply(2)    │
   │       │ - 目标: 请求者      │
   │       │ - 发送者: 本地      │
   │       └─────────────────────┘
   │              │
   │              ▼
   │       发送ARP应答帧
   │
   └─No──▶ 丢弃

接收ARP应答:
───────────
以太网帧 (EtherType=0x0806)
   │
   ▼
┌─────────────────────┐
│ 解析ARP包            │
│ - 操作: Reply(2)    │
│ - 发送者MAC         │
│ - 发送者IP          │
└─────────────────────┘
   │
   ▼
┌─────────────────────┐
│ 更新ARP缓存          │
│ IP → MAC映射        │
│ 缓存大小: 2^9=512   │
└─────────────────────┘
   │
   ▼
等待的TX包可以发送

发送数据需要ARP:
─────────────
应用层发送IP包
   │
   ▼
查询ARP缓存: 目标IP
   │
   ├─找到──▶ 使用缓存的MAC地址
   │         │
   │         ▼
   │      直接发送
   │
   └─未找到─▶ ┌─────────────────────┐
             │ 发送ARP请求          │
             │ - 目标IP: 待查询    │
             │ - 广播地址          │
             └─────────────────────┘
                    │
                    ▼
             等待ARP应答
             (超时重试4次)
                    │
                    ├─收到应答─▶ 缓存并发送
                    │
                    └─超时────▶ 发送失败
```

## 8. 性能指标

```
┌──────────────────────────────────────────────────────────────────┐
│                         性能参数                                  │
└──────────────────────────────────────────────────────────────────┘

接口带宽:
─────────
• RGMII:         1 Gbps (全双工)
• AXI Master:    可配置 (64-bit @ logic_clk)
• AXI-Lite:      32-bit @ logic_clk

延迟:
─────
• MAC RX延迟:    ~500ns (帧起始到FIFO)
• MAC TX延迟:    ~500ns (FIFO到线路)
• 过滤器延迟:    ~14字节时间 (检测目的MAC)
• DMA延迟:       5-15ms (取决于AXI总线)
• AXI-Lite访问:  40-60ns (2-3周期)

缓冲:
─────
• TX FIFO:       4096 字节 (约2.7个最大帧)
• RX FIFO:       4096 字节
• ARP缓存:       512 条目

吞吐量:
───────
• 理论最大:      1 Gbps
• 实际(测试):    ~800 Mbps (取决于帧大小)
• 最小帧速率:    ~1.488 Mpps (64字节帧)
• 最大帧速率:    ~812 kpps (1518字节帧)
```

---

**文档版本**: v1.0  
**生成日期**: 2025年10月7日  
**相关文件**: eth_mac_rgmii_axi.v

